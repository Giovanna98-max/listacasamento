<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Check-in do Casamento</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 20px; }
    video { width: 300px; height: auto; margin-top: 10px; }
    #result { margin-top: 20px; font-size: 18px; font-weight: bold; }
    #codesList { text-align: left; max-width: 300px; margin: 20px auto; }
  </style>
</head>
<body>
  <h2>Check-in do Casamento</h2>
  <video id="preview"></video>
  <div id="result"></div>
  <div id="codesList">
    <p>üìã <strong>C√≥digos lidos da planilha:</strong></p>
    <ul id="codeList"></ul>
  </div>

  <script type="module">
    import QrScanner from "https://cdn.jsdelivr.net/npm/qr-scanner@1.4.2/qr-scanner.min.js";

    const videoElem = document.getElementById('preview');
    const resultElem = document.getElementById('result');
    const codeListElem = document.getElementById('codeList');

    let validGuests = {};

    // Carrega os dados da planilha
    fetch("https://opensheet.elk.sh/1IkI3IVm0Awu4bqilDHBk6M_t1aaN-zEUT3Y_O0UBoH4/Sheet1")
      .then(res => res.json())
      .then(data => {
        data.forEach(item => {
          const code = item["C√≥digo"]?.trim();
          const nome = item["Nome"]?.trim();
          if (code && nome) {
            validGuests[code] = nome;
            const li = document.createElement("li");
            li.textContent = code;
            codeListElem.appendChild(li);
          }
        });

        startScanner();
      })
      .catch(err => {
        resultElem.innerHTML = "<span style='color:red;'>Erro ao carregar dados da planilha.</span>";
        console.error(err);
      });

    function startScanner() {
      const scanner = new QrScanner(videoElem, result => {
        const code = result.data.trim();
        const nome = validGuests[code];
        if (nome) {
          resultElem.innerHTML = `<span style='color:green;'>‚úîÔ∏è Convidado confirmado: <strong>${nome}</strong> (${code})</span>`;
        } else {
          resultElem.innerHTML = `<span style='color:red;'>‚ùå C√≥digo n√£o encontrado: ${code}</span>`;
        }
      });
      scanner.start();
    }
  </script>
</body>
</html>
