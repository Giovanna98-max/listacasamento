<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Check-in de Convidados</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>
  <h1>Check-in do Casamento</h1>
  <div id="reader" style="width: 300px"></div>
  <h2 id="resultado"></h2>

  <script>
    // ID da sua planilha
    const SHEET_ID = "1IkI3IVm0Awu4bqilDHBk6M_t1aaN-zEUT3Y_O0UBoH4";
    const SHEET_NAME = "Página1"; // altere se o nome da aba for outro

    async function verificarConvidado(nomeDoQRCode) {
      const url = https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME};
      try {
        const res = await fetch(url);
        const text = await res.text();
        const json = JSON.parse(text.substr(47).slice(0, -2));
        const dados = json.table.rows.map(r => r.c[0]?.v?.toLowerCase());

        return dados.includes(nomeDoQRCode.toLowerCase());
      } catch (error) {
        console.error("Erro ao buscar planilha:", error);
        return false;
      }
    }

    function onScanSuccess(decodedText) {
      html5QrcodeScanner.clear();

      document.getElementById("resultado").innerText = "Verificando...";
      verificarConvidado(decodedText).then(existe => {
        if (existe) {
          document.getElementById("resultado").innerText = ✅ Entrada autorizada para: ${decodedText};
        } else {
          document.getElementById("resultado").innerText = ❌ Nome não encontrado: ${decodedText};
        }
      });
    }

    const html5QrcodeScanner = new Html5QrcodeScanner(
      "reader", { fps: 10, qrbox: 250 }
    );
    html5QrcodeScanner.render(onScanSuccess);
  </script>
</body>
</html>
