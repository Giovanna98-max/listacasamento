<div id="scanner"></div>
<div id="resultado"></div>
<div id="lista-codigos"></div>

<script>
    let convidados = [];

    async function carregarDadosPlanilha() {
        const url = const url = 'https://opensheet.elk.sh/1IkI3IVm0Awu4bqilDHBk6M_t1aaN-zEUT3Y_O0UBoH4/PRESEN√áA CASAMENTO';
        try {
            const resposta = await fetch(url);
            const dados = await resposta.json();
            convidados = dados.map(item => item['C√≥digo']);

            const listaDiv = document.getElementById("lista-codigos");
            listaDiv.innerHTML = "<h3>üìã C√≥digos lidos da planilha:</h3><ul>" + 
                convidados.map(c => `<li>${c}</li>`).join("") + "</ul>";
        } catch (erro) {
            console.error("Erro ao carregar dados da planilha:", erro);
        }
    }

    function iniciarScanner() {
        const html5QrCode = new Html5Qrcode("scanner");
        const config = { fps: 10, qrbox: 250 };

        html5QrCode.start(
            { facingMode: "environment" },
            config,
            (decodedText, decodedResult) => {
                html5QrCode.stop();
                validarCodigo(decodedText);
            },
            (errorMessage) => {
                console.warn(`Erro no scan: ${errorMessage}`);
            }
        ).catch(err => console.error("Erro ao iniciar scanner", err));
    }

    function validarCodigo(codigo) {
    const resultadoDiv = document.getElementById("resultado");
    if (convidados.includes(codigo.trim())) {
        resultadoDiv.innerHTML = `<p style="color:green; font-weight:bold;">‚úîÔ∏è Convidado confirmado: ${codigo}</p>`;
    } else {
        resultadoDiv.innerHTML = `<p style="color:red; font-weight:bold;">‚ùå Nome n√£o encontrado: ${codigo}</p>`;
    }
}

// Exibe os c√≥digos carregados no final da p√°gina
function mostrarCodigosNaTela() {
    const listaDiv = document.getElementById("lista-codigos");
    listaDiv.innerHTML = "<h3>üìã C√≥digos lidos da planilha:</h3><ul>" + 
        convidados.map(c => `<li>${c}</li>`).join("") + "</ul>";
}

async function carregarDadosPlanilha() {
    const url = 'https://opensheet.elk.sh/1IkI3IVm0Awu4bqilDHBk6M_t1aaN-zEUT3Y_O0UBoH4/PRESEN√áA CASAMENTO';
    try {
        const resposta = await fetch(url);
        const dados = await resposta.json();
        convidados = dados.map(item => item['C√≥digo'].trim());
        mostrarCodigosNaTela();
    } catch (erro) {
        console.error("Erro ao carregar dados da planilha:", erro);
    }
}

carregarDadosPlanilha();
iniciarScanner();
</script>

<!-- Coloque isso antes do fechamento do </body> -->
<div id="lista-codigos" style="margin-top: 40px; padding: 10px;"></div>
